# ðŸ€ Silver Events Configuration

description: |
  Cleaned and validated website analytics events.

  Transformations:
  - Filters invalid records (null IDs, future timestamps)
  - Standardizes event_type to uppercase
  - Adds processing metadata

  Quality Checks:
  - No null user_ids or event_ids
  - No future timestamps
  - No duplicate event_ids

owner: data-team@acme.com

columns:
  - name: event_id
    type: string
    description: Unique event identifier
    tests:
      - not_null
      - unique

  - name: user_id
    type: string
    description: Anonymous user identifier
    tests:
      - not_null

  - name: event_type
    type: string
    description: Type of event (PAGEVIEW, CLICK, etc.)
    tests:
      - not_null
      - accepted_values: [PAGEVIEW, CLICK, SCROLL, FORM_SUBMIT, PURCHASE]

  - name: page_url
    type: string
    description: URL of the page where event occurred

  - name: event_timestamp
    type: timestamp
    description: When the event occurred
    tests:
      - not_null

  - name: event_date
    type: date
    description: Date of the event (partition column)
    tests:
      - not_null

  - name: device
    type: string
    description: Device type (desktop, mobile, tablet)
    tests:
      - accepted_values: [desktop, mobile, tablet]

  - name: country
    type: string
    description: User's country code

  - name: session_duration_sec
    type: int
    description: Session duration in seconds
    tests:
      - positive

freshness:
  warn_after:
    hours: 6
  error_after:
    hours: 24

tests:
  - name: no_future_events
    sql: |
      SELECT COUNT(*)
      FROM {{ this }}
      WHERE event_timestamp > NOW()
    expect: 0
    severity: error

  - name: valid_event_types
    sql: |
      SELECT COUNT(*)
      FROM {{ this }}
      WHERE event_type NOT IN ('PAGEVIEW', 'CLICK', 'SCROLL', 'FORM_SUBMIT', 'PURCHASE')
    expect: 0
    severity: error
